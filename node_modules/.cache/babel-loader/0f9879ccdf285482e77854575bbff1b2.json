{"ast":null,"code":"import axios from 'axios';\nimport jwtDefaultConfig from './jwtDefaultConfig';\nexport default class JwtService {\n  constructor(jwtOverrideConfig) {\n    // ** jwtConfig <= Will be used by this service\n    this.jwtConfig = {\n      ...jwtDefaultConfig\n    };\n    // ** For Refreshing Token\n    this.isAlreadyFetchingAccessToken = false;\n    // ** For Refreshing Token\n    this.subscribers = [];\n    this.jwtConfig = {\n      ...this.jwtConfig,\n      ...jwtOverrideConfig\n    };\n\n    // ** Request Interceptor\n    axios.interceptors.request.use(config => {\n      // ** Get token from localStorage\n      const accessToken = this.getToken();\n\n      // ** If token is present add it to request's Authorization Header\n      if (accessToken) {\n        // ** eslint-disable-next-line no-param-reassign\n        config.headers.Authorization = \"\".concat(this.jwtConfig.tokenType, \" \").concat(accessToken);\n      }\n      return config;\n    }, error => Promise.reject(error));\n\n    // ** Add request/response interceptor\n    axios.interceptors.response.use(response => response, error => {\n      // ** const { config, response: { status } } = error\n      const {\n        config,\n        response\n      } = error;\n      const originalRequest = config;\n\n      // ** if (status === 401) {\n      if (response && response.status === 401) {\n        if (!this.isAlreadyFetchingAccessToken) {\n          this.isAlreadyFetchingAccessToken = true;\n          this.refreshToken().then(r => {\n            this.isAlreadyFetchingAccessToken = false;\n\n            // ** Update accessToken in localStorage\n            this.setToken(r.data.accessToken);\n            this.setRefreshToken(r.data.refreshToken);\n            this.onAccessTokenFetched(r.data.accessToken);\n          });\n        }\n        const retryOriginalRequest = new Promise(resolve => {\n          this.addSubscriber(accessToken => {\n            // ** Make sure to assign accessToken according to your response.\n            // ** Check: https://pixinvent.ticksy.com/ticket/2413870\n            // ** Change Authorization header\n            originalRequest.headers.Authorization = \"\".concat(this.jwtConfig.tokenType, \" \").concat(accessToken);\n            resolve(this.axios(originalRequest));\n          });\n        });\n        return retryOriginalRequest;\n      }\n      return Promise.reject(error);\n    });\n  }\n  onAccessTokenFetched(accessToken) {\n    this.subscribers = this.subscribers.filter(callback => callback(accessToken));\n  }\n  addSubscriber(callback) {\n    this.subscribers.push(callback);\n  }\n  getToken() {\n    return localStorage.getItem(this.jwtConfig.storageTokenKeyName);\n  }\n  getRefreshToken() {\n    return localStorage.getItem(this.jwtConfig.storageRefreshTokenKeyName);\n  }\n  setToken(value) {\n    localStorage.setItem(this.jwtConfig.storageTokenKeyName, value);\n  }\n  setRefreshToken(value) {\n    localStorage.setItem(this.jwtConfig.storageRefreshTokenKeyName, value);\n  }\n  login() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return axios.post(this.jwtConfig.loginEndpoint, ...args);\n  }\n  register() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return axios.post(this.jwtConfig.registerEndpoint, ...args);\n  }\n  refreshToken() {\n    return axios.post(this.jwtConfig.refreshEndpoint, {\n      refreshToken: this.getRefreshToken()\n    });\n  }\n}","map":{"version":3,"names":["axios","jwtDefaultConfig","JwtService","constructor","jwtOverrideConfig","jwtConfig","isAlreadyFetchingAccessToken","subscribers","interceptors","request","use","config","accessToken","getToken","headers","Authorization","concat","tokenType","error","Promise","reject","response","originalRequest","status","refreshToken","then","r","setToken","data","setRefreshToken","onAccessTokenFetched","retryOriginalRequest","resolve","addSubscriber","filter","callback","push","localStorage","getItem","storageTokenKeyName","getRefreshToken","storageRefreshTokenKeyName","value","setItem","login","_len","arguments","length","args","Array","_key","post","loginEndpoint","register","_len2","_key2","registerEndpoint","refreshEndpoint"],"sources":["E:/EXAI/EX-AI/src/@core/auth/jwt/jwtService.js"],"sourcesContent":["import axios from 'axios'\nimport jwtDefaultConfig from './jwtDefaultConfig'\n\nexport default class JwtService {\n  // ** jwtConfig <= Will be used by this service\n  jwtConfig = { ...jwtDefaultConfig }\n\n  // ** For Refreshing Token\n  isAlreadyFetchingAccessToken = false\n\n  // ** For Refreshing Token\n  subscribers = []\n\n  constructor(jwtOverrideConfig) {\n    this.jwtConfig = { ...this.jwtConfig, ...jwtOverrideConfig }\n\n    // ** Request Interceptor\n    axios.interceptors.request.use(\n      config => {\n        // ** Get token from localStorage\n        const accessToken = this.getToken()\n\n        // ** If token is present add it to request's Authorization Header\n        if (accessToken) {\n          // ** eslint-disable-next-line no-param-reassign\n          config.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`\n        }\n        return config\n      },\n      error => Promise.reject(error)\n    )\n\n    // ** Add request/response interceptor\n    axios.interceptors.response.use(\n      response => response,\n      error => {\n        // ** const { config, response: { status } } = error\n        const { config, response } = error\n        const originalRequest = config\n\n        // ** if (status === 401) {\n        if (response && response.status === 401) {\n          if (!this.isAlreadyFetchingAccessToken) {\n            this.isAlreadyFetchingAccessToken = true\n            this.refreshToken().then(r => {\n              this.isAlreadyFetchingAccessToken = false\n\n              // ** Update accessToken in localStorage\n              this.setToken(r.data.accessToken)\n              this.setRefreshToken(r.data.refreshToken)\n\n              this.onAccessTokenFetched(r.data.accessToken)\n            })\n          }\n          const retryOriginalRequest = new Promise(resolve => {\n            this.addSubscriber(accessToken => {\n              // ** Make sure to assign accessToken according to your response.\n              // ** Check: https://pixinvent.ticksy.com/ticket/2413870\n              // ** Change Authorization header\n              originalRequest.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`\n              resolve(this.axios(originalRequest))\n            })\n          })\n          return retryOriginalRequest\n        }\n        return Promise.reject(error)\n      }\n    )\n  }\n\n  onAccessTokenFetched(accessToken) {\n    this.subscribers = this.subscribers.filter(callback => callback(accessToken))\n  }\n\n  addSubscriber(callback) {\n    this.subscribers.push(callback)\n  }\n\n  getToken() {\n    return localStorage.getItem(this.jwtConfig.storageTokenKeyName)\n  }\n\n  getRefreshToken() {\n    return localStorage.getItem(this.jwtConfig.storageRefreshTokenKeyName)\n  }\n\n  setToken(value) {\n    localStorage.setItem(this.jwtConfig.storageTokenKeyName, value)\n  }\n\n  setRefreshToken(value) {\n    localStorage.setItem(this.jwtConfig.storageRefreshTokenKeyName, value)\n  }\n\n  login(...args) {\n    return axios.post(this.jwtConfig.loginEndpoint, ...args)\n  }\n\n  register(...args) {\n    return axios.post(this.jwtConfig.registerEndpoint, ...args)\n  }\n\n  refreshToken() {\n    return axios.post(this.jwtConfig.refreshEndpoint, {\n      refreshToken: this.getRefreshToken()\n    })\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}