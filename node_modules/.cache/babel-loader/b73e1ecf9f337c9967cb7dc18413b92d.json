{"ast":null,"code":"import t, { PureComponent as n, createElement as r } from \"react\";\nfunction i(t, n) {\n  for (var r = 0; r < n.length; r++) {\n    var i = n[r];\n    i.enumerable = i.enumerable || false;\n    i.configurable = true;\n    if (\"value\" in i) i.writable = true;\n    Object.defineProperty(t, i.key, i);\n  }\n}\nfunction u(t, n, r) {\n  if (n) i(t.prototype, n);\n  if (r) i(t, r);\n  return t;\n}\nfunction e() {\n  e = Object.assign || function (t) {\n    for (var n = 1; n < arguments.length; n++) {\n      var r = arguments[n];\n      for (var i in r) if (Object.prototype.hasOwnProperty.call(r, i)) t[i] = r[i];\n    }\n    return t;\n  };\n  return e.apply(this, arguments);\n}\nfunction o(t, n) {\n  t.prototype = Object.create(n.prototype);\n  t.prototype.constructor = t;\n  f(t, n);\n}\nfunction f(t, n) {\n  f = Object.setPrototypeOf || function t(n, r) {\n    n.__proto__ = r;\n    return n;\n  };\n  return f(t, n);\n}\nvar c = function t() {};\nvar s = function (t) {\n  o(n, t);\n  function n() {\n    var n;\n    for (var r = arguments.length, i = new Array(r), u = 0; u < r; u++) i[u] = arguments[u];\n    n = t.call.apply(t, [this].concat(i)) || this;\n    n.t = false;\n    n.i = null;\n    n.u = c;\n    return n;\n  }\n  var r = n.prototype;\n  r.componentWillUnmount = function t() {\n    this.u();\n  };\n  r.o = function _connectToAbility(t) {\n    var n = this;\n    if (t === this.i) return;\n    this.u();\n    this.i = null;\n    if (t) {\n      this.i = t;\n      this.u = t.on(\"updated\", function () {\n        return n.forceUpdate();\n      });\n    }\n  };\n  r.h = function t() {\n    var n = this.props;\n    var r = n.of || n.a || n.an || n.this || n.on;\n    var i = n.not ? \"cannot\" : \"can\";\n    return n.ability[i](n.I || n.do, r, n.field);\n  };\n  r.render = function t() {\n    this.o(this.props.ability);\n    this.t = this.h();\n    return this.props.passThrough || this.t ? this.v() : null;\n  };\n  r.v = function t() {\n    var n = this.props,\n      r = n.children,\n      i = n.ability;\n    var u = \"function\" === typeof r ? r(this.t, i) : r;\n    return u;\n  };\n  u(n, [{\n    key: \"allowed\",\n    get: function t() {\n      return this.t;\n    }\n  }]);\n  return n;\n}(n);\nfunction a(t) {\n  var n, r;\n  return r = n = function (t) {\n    o(n, t);\n    function n() {\n      return t.apply(this, arguments) || this;\n    }\n    return n;\n  }(s), n.defaultProps = {\n    ability: t\n  }, r;\n}\nfunction h(t) {\n  return function (n) {\n    return r(t, {\n      children: function t(i) {\n        return r(s, e({\n          ability: i\n        }, n));\n      }\n    });\n  };\n}\nfunction useAbility(n) {\n  if (\"production\" !== process.env.NODE_ENV && \"function\" !== typeof t.useContext) throw new Error(\"You must use React >= 16.8 in order to use useAbility()\");\n  var r = t.useContext(n);\n  var i = t.useState(),\n    u = i[0],\n    e = i[1];\n  t.useEffect(function () {\n    return r.on(\"updated\", function (t) {\n      if (t.rules !== u) e(t.rules);\n    });\n  }, []);\n  return r;\n}\nexport { s as Can, a as createCanBoundTo, h as createContextualCan, useAbility };","map":{"version":3,"names":["c","t","s","o","n","r","arguments","length","i","Array","u","call","apply","concat","prototype","componentWillUnmount","_connectToAbility","on","forceUpdate","h","props","of","a","an","this","not","ability","I","do","field","render","passThrough","v","children","key","get","defaultProps","e","useAbility","process","env","NODE_ENV","useContext","Error","useState","useEffect","rules","Can","createCanBoundTo","createContextualCan"],"sources":["../../src/Can.ts","../../src/factory.ts","../../src/hooks/useAbility.ts"],"sourcesContent":["import { PureComponent, ReactNode } from 'react';\nimport {\n  Unsubscribe,\n  AbilityTuple,\n  SubjectType,\n  AnyAbility,\n  Generics,\n  Abilities,\n  IfString,\n} from '@casl/ability';\n\nconst noop = () => {};\n\ntype AbilityCanProps<\n  T extends Abilities,\n  Else = IfString<T, { do: T } | { I: T }>\n> = T extends AbilityTuple\n  ? { do: T[0], on: T[1], field?: string } |\n  { I: T[0], a: Extract<T[1], SubjectType>, field?: string } |\n  { I: T[0], an: Extract<T[1], SubjectType>, field?: string } |\n  { I: T[0], this: Exclude<T[1], SubjectType>, field?: string }\n  : Else;\n\ninterface ExtraProps {\n  not?: boolean\n  passThrough?: boolean\n}\n\ninterface CanExtraProps<T extends AnyAbility> extends ExtraProps {\n  ability: T\n  children: ReactNode | ((isAllowed: boolean, ability: T) => ReactNode)\n}\n\ninterface BoundCanExtraProps<T extends AnyAbility> extends ExtraProps {\n  ability?: T\n  children: ReactNode | ((isAllowed: boolean, ability: T) => ReactNode)\n}\n\nexport type CanProps<T extends AnyAbility> =\n  AbilityCanProps<Generics<T>['abilities']> & CanExtraProps<T>;\nexport type BoundCanProps<T extends AnyAbility> =\n  AbilityCanProps<Generics<T>['abilities']> & BoundCanExtraProps<T>;\n\nexport class Can<\n  T extends AnyAbility,\n  IsBound extends boolean = false\n> extends PureComponent<IsBound extends true ? BoundCanProps<T> : CanProps<T>> {\n  private _isAllowed: boolean = false;\n  private _ability: T | null = null;\n  private _unsubscribeFromAbility: Unsubscribe = noop;\n\n  componentWillUnmount() {\n    this._unsubscribeFromAbility();\n  }\n\n  private _connectToAbility(ability?: T) {\n    if (ability === this._ability) {\n      return;\n    }\n\n    this._unsubscribeFromAbility();\n    this._ability = null;\n\n    if (ability) {\n      this._ability = ability;\n      this._unsubscribeFromAbility = ability.on('updated', () => this.forceUpdate());\n    }\n  }\n\n  get allowed() {\n    return this._isAllowed;\n  }\n\n  private _canRender(): boolean {\n    const props: any = this.props;\n    const subject = props.of || props.a || props.an || props.this || props.on;\n    const can = props.not ? 'cannot' : 'can';\n\n    return props.ability[can](props.I || props.do, subject, props.field);\n  }\n\n  render() {\n    this._connectToAbility(this.props.ability);\n    this._isAllowed = this._canRender();\n    return this.props.passThrough || this._isAllowed ? this._renderChildren() : null;\n  }\n\n  private _renderChildren() {\n    const { children, ability } = this.props;\n    const elements = typeof children === 'function'\n      ? children(this._isAllowed, ability as any)\n      : children;\n\n    return elements as ReactNode;\n  }\n}\n","import { createElement as h, ComponentClass, Consumer, FunctionComponent } from 'react';\nimport { AnyAbility } from '@casl/ability';\nimport { Can, BoundCanProps } from './Can';\n\ninterface BoundCanClass<T extends AnyAbility> extends ComponentClass<BoundCanProps<T>> {\n  new (props: BoundCanProps<T>, context?: any): Can<T, true>\n}\n\nexport function createCanBoundTo<T extends AnyAbility>(ability: T): BoundCanClass<T> {\n  return class extends Can<T, true> {\n    static defaultProps = { ability } as BoundCanClass<T>['defaultProps'];\n  };\n}\n\nexport function createContextualCan<T extends AnyAbility>(\n  Getter: Consumer<T>\n): FunctionComponent<BoundCanProps<T>> {\n  return (props: BoundCanProps<T>) => h(Getter, {\n    children: (ability: T) => h(Can, {\n      ability,\n      ...props,\n    } as any)\n  });\n}\n","import React from 'react';\nimport { AnyAbility } from '@casl/ability';\n\nexport function useAbility<T extends AnyAbility>(context: React.Context<T>): T {\n  if (process.env.NODE_ENV !== 'production' && typeof React.useContext !== 'function') {\n    /* istanbul ignore next */\n    throw new Error('You must use React >= 16.8 in order to use useAbility()');\n  }\n\n  const ability = React.useContext<T>(context);\n  const [rules, setRules] = React.useState<T['rules']>();\n\n  React.useEffect(() => ability.on('updated', (event) => {\n    if (event.rules !== rules) {\n      setRules(event.rules);\n    }\n  }), []);\n\n  return ability;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}